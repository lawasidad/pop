<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>New Customer</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    label {
      display: block;
      margin-bottom: 10px;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #0056b3;
    }
    .location-btn {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h2>ÙÛ†Ø±Ù…ÛŒ Ú©Ú•ÛŒØ§Ø±ÛŒ Ù†ÙˆÛ</h2>
  <form id="customerForm">
    <label>Ú©Û†Ø¯ÛŒ Ú©Ú•ÛŒØ§Ø±:
      <input type="text" id="code" required />
    </label>

    <label>Ù†Ø§Ùˆ:
      <input type="text" id="name" required />
    </label>

    <label>Ù…Û†Ø¨Ø§ÛŒÙ„:
      <input type="text" id="mobile" required />
    </label>

    <label>Ø¨Û•Ø±Ù‡Û•Ù…ÛŒ Ú©Ú•ÛŒØ§Ø± (Balance):
      <input type="number" id="balance" required />
    </label>

    <label>Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø¬ÛÚ¯Ø±Û•ÙˆÛ• (Geo Location):
      <input type="text" id="location" readonly required />
    </label>

    <button type="button" class="location-btn" onclick="getLocation()">ğŸ“ ÙˆÛ•Ø±Ú¯Ø±ØªÙ†ÛŒ Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø¬ÛÚ¯Ø±Û•ÙˆÛ•</button>

    <button type="submit">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ú©Ú•ÛŒØ§Ø±</button>
  </form>

  <script>
    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function(position) {
            const coords = position.coords.latitude + "," + position.coords.longitude;
            document.getElementById("location").value = coords;
          },
          function(error) {
            alert("Ù†Ø§ØªÙˆØ§Ù†Ø±ÛØª Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù† ÙˆÛ•Ø±Ú¯ÛŒØ±Ø§. ØªÚ©Ø§ÛŒÛ• Ú•ÛÚ¯Û• Ø¨Ø¯Û• Ø¨Û† Ø¯Û•Ø³ØªÚ¯Û•ÛŒØ´ØªÙ† Ø¨Û• GPS.");
          }
        );
      } else {
        alert("Ù¾ÛÙˆÛ•Ú©Ø±Ø§ÙˆÛ•Ú©Û•Øª Ø¬ÛÚ¯Ø±Û•ÙˆÛ• Ù¾Ø´ØªÛŒÙˆØ§Ù†ÛŒ Ù†Ø§Ú©Ø§Øª.");
      }
    }

    document.getElementById("customerForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const code = document.getElementById("code").value.trim();
      const name = document.getElementById("name").value.trim();
      const mobile = document.getElementById("mobile").value.trim();
      const balance = document.getElementById("balance").value.trim();
      const location = document.getElementById("location").value.trim();

      if (!location) {
        alert("ØªÚ©Ø§ÛŒÛ• Ø³Û•Ø±Û•ØªØ§ Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø¬ÛÚ¯Ø±Û•ÙˆÛ• Ø¨Ú©Û•ÙˆÛ•.");
        return;
      }

      const customer = { code, name, mobile, balance, location };

      // ØªÛ•Ù†Ù‡Ø§ Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¦Û•Ù… Ú©Ú•ÛŒØ§Ø±Û• (Ù¾ÛØ´ Ø¦Û•ÙˆÛ• Ø¯Ø§ØªØ§Ú©Ø§Ù†ÛŒ Ú©Û†Ù† Ù¾Ø§Ú© Ø¯Û•Ú©Ø§Øª)
      localStorage.removeItem("customers");
      localStorage.setItem("customers", JSON.stringify([customer]));

      // Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù¾Û•Ú•Û•ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ Ø¨Û† Ø¦Û•ÙˆÛ•ÛŒ Ø¯Ø§ØªØ§Ú©Û• Ù†ÙˆÛ Ø¨Ú©Ø±ÛØªÛ•ÙˆÛ•
      window.parent.postMessage("customer-added", "*");

      // Ø¯Ø§ØªØ§Ú©Ø§Ù† Ù¾Ø§Ú© Ø¨Ú©Û• Ù„Û• ÙÛ†Ø±Ù…Û•Ú©Û• Ø¨Û† Ø¯ÙˆØ§ØªØ±
      this.reset();
      document.getElementById("location").value = "";
      alert("Ú©Ú•ÛŒØ§Ø± Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ø²ÛŒØ§Ø¯Ú©Ø±Ø§!");
    });
  </script>
</body>
</html>
