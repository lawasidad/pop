<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Form - Add Customer</title>
<style>
  body {
    background: #f4f6f9;
    font-family: Arial, sans-serif;
    padding: 20px;
    max-width: 480px;
    margin: auto;
    direction: rtl;
  }
  .form-box {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  h2 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 22px;
    direction: ltr;
  }
  label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    direction: ltr;
    text-align: right;
  }
  input, select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 16px;
    direction: ltr;
    text-align: left;
  }
  .gps-group {
    display: flex;
    align-items: center;
    direction: ltr;
  }
  .gps-group input {
    flex: 1;
  }
  .gps-btn {
    margin-left: 10px;
    background: #007bff;
    color: white;
    border: none;
    padding: 10px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
  }
  .gps-btn:hover {
    background-color: #0056b3;
  }
  .submit-btn {
    width: 100%;
    background: #28a745;
    color: white;
    border: none;
    padding: 12px;
    font-size: 16px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
  }
  .submit-btn:hover {
    background: #218838;
  }
</style>
</head>
<body>

<div class="form-box" dir="ltr">
  <h2>Ú©Ú•ÛŒØ§Ø±ÛÚ©ÛŒ Ù†ÙˆÛ Ø²ÛŒØ§Ø¯ Ø¨Ú©Û•</h2>

  <label for="code">Ú©Û†Ø¯ÛŒ Ú©Ú•ÛŒØ§Ø± <span style="color:red">*</span></label>
  <input type="text" id="code" placeholder="Ú©Û†Ø¯ÛŒ Ú©Ú•ÛŒØ§Ø± Ø¨Ù†ÙˆØ³Û•" required autocomplete="off" />

  <label for="name">Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ <span style="color:red">*</span></label>
  <input type="text" id="name" placeholder="Ù†Ø§ÙˆÛŒ ØªÛ•ÙˆØ§Ùˆ Ø¨Ù†ÙˆØ³Û•" required autocomplete="off" />

  <label for="mobile">Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ <span style="color:red">*</span></label>
  <input type="tel" id="mobile" placeholder="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ù†ÙˆØ³Û•" required autocomplete="off" pattern="[0-9+\-\s]{7,15}" title="Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„Û•Ú©Û• Ú•Ø§Ø³Øª Ø¨Ù†ÙˆØ³Û•" />

  <label for="balance">Ù‚Û•Ø±Ø²/Ø¨Û•Ù„Ø§Ù†Ø³</label>
  <input type="number" id="balance" placeholder="Ù " value="0" min="0" step="0.01" />

  <label for="route">ÙˆÚµØ§Øª</label>
  <select id="route">
    <option value="" selected disabled>ÙˆÚµØ§Øª Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
  </select>

  <label for="city">Ø´Ø§Ø±</label>
  <select id="city">
    <option value="" selected disabled>Ø´Ø§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
  </select>

  <label for="area">Ù†Ø§ÙˆÚ†Û•</label>
  <select id="area">
    <option value="" selected disabled>Ù†Ø§ÙˆÚ†Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>
  </select>

  <label for="location">Ø´ÙˆÛÙ† (GPS)</label>
  <div class="gps-group">
    <input type="text" id="location" placeholder="Ú©Ù„ÛŒÙ„ Ø¨Ú©Û• Ø¨Û† Ú¯Ø±ØªÙ†ÛŒ Ø´ÙˆÛÙ†" readonly />
    <button class="gps-btn" type="button" onclick="getLocation()">ğŸ“</button>
  </div>

  <button class="submit-btn" type="button" onclick="saveCustomer()">Ø³Û•ÛŒÚ¤</button>
</div>

<script>
  // Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Ø§Ù†ÛŒ localStorage Ø¨Û† Ù‡Ø§ÙˆØ¨Û•Ø´ÛŒ Ù†Ø§ÙˆÛ•Ú©Ø§Ù† Ù„Û• new_sales.html
  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const lat = position.coords.latitude.toFixed(5);
        const lon = position.coords.longitude.toFixed(5);
        document.getElementById("location").value = lat + ", " + lon;
        window.open(`https://maps.google.com/?q=${lat},${lon}`, "_blank");
      }, function(error) {
        alert("Ú©ÛØ´Û• Ù„Û• Ú¯Ø±ØªÙ†ÛŒ Ø´ÙˆÛÙ†: " + error.message);
      });
    } else {
      alert("Ú¯Û•Ù„Û•Ú©Û• Ù†Ø§ØªÙˆØ§Ù†ÛØª Ø´ÙˆÛÙ†Û•Ú©Ø§Ù† Ø¨Û•Ø¯Û•Ø³Øª Ø¨Ù‡ÛÙ†ÛØª.");
    }
  }

  function loadRouteData() {
    // Ø¦Û•Ù… Ù†Ù…ÙˆÙˆÙ†Û•ÛŒÛ• Ø¨Û† Ù¾Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù†Ø§ÙˆÛ•Ú©Ø§Ù† Ùˆ Ù‡Û•Ø±ÙˆÛ•Ù‡Ø§ ÙˆÚµØ§ØªØŒ Ø´Ø§Ø±ØŒ Ù†Ø§ÙˆÚ†Û•
    const routes = [
      { country: "Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†", city: "Ø³Ù„ÛÙ…Ø§Ù†ÛŒ", area: "Ù†Ø§ÙˆÚ†Û•ÛŒÛ•Ú©" },
      { country: "Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†", city: "Ù‡Û•ÙˆÙ„ÛØ±", area: "Ù†Ø§ÙˆÚ†Û•ÛŒ Ø¯ÙˆÙˆÛ•Ù…" },
      { country: "Ø¹ÛØ±Ø§Ù‚", city: "Ø¨Û•ØºØ¯Ø§", area: "Ù†Ø§ÙˆÚ†Û•ÛŒ Ø³ÛÛŒÛ•Ù…" }
    ];

    const routeSelect = document.getElementById("route");
    const citySelect = document.getElementById("city");
    const areaSelect = document.getElementById("area");

    const countries = [...new Set(routes.map(r => r.country))];
    countries.forEach(c => {
      const option = document.createElement("option");
      option.value = c;
      option.textContent = c;
      routeSelect.appendChild(option);
    });

    routeSelect.addEventListener("change", () => {
      const selectedCountry = routeSelect.value;
      const cities = [...new Set(routes.filter(r => r.country === selectedCountry).map(r => r.city))];
      citySelect.innerHTML = '<option value="" selected disabled>Ø´Ø§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>';
      areaSelect.innerHTML = '<option value="" selected disabled>Ù†Ø§ÙˆÚ†Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>';
      cities.forEach(city => {
        const option = document.createElement("option");
        option.value = city;
        option.textContent = city;
        citySelect.appendChild(option);
      });
    });

    citySelect.addEventListener("change", () => {
      const selectedCountry = routeSelect.value;
      const selectedCity = citySelect.value;
      const areas = routes.filter(r => r.country === selectedCountry && r.city === selectedCity).map(r => r.area);
      areaSelect.innerHTML = '<option value="" selected disabled>Ù†Ø§ÙˆÚ†Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>';
      areas.forEach(area => {
        const option = document.createElement("option");
        option.value = area;
        option.textContent = area;
        areaSelect.appendChild(option);
      });
    });
  }

  function saveCustomer() {
    const code = document.getElementById("code").value.trim();
    const name = document.getElementById("name").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    const balance = parseFloat(document.getElementById("balance").value.trim() || "0");
    const route = document.getElementById("route").value;
    const city = document.getElementById("city").value;
    const area = document.getElementById("area").value;
    const location = document.getElementById("location").value.trim();

    if (!code || !name || !mobile) {
      alert("ØªÚ©Ø§ÛŒÛ• Ø®Ø§Ù†Û•Ú©Ø§Ù†ÛŒ Ù‡Û•Ø±ÛŒÛ•Ú© Ù„Û• Ø³Û•Ø±Û•Ú©ÛŒÛŒÛ•Ú©Ø§Ù† Ù¾Ú• Ø¨Ú©Û•ÙˆÛ•.");
      return;
    }

    const mobilePattern = /^[0-9+\-\s]{7,15}$/;
    if (!mobilePattern.test(mobile)) {
      alert("ØªÚ©Ø§ÛŒÛ• Ú˜Ù…Ø§Ø±Û•ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„Û•Ú©Û• Ú•Ø§Ø³Øª Ø¨Ù†ÙˆØ³Û•.");
      return;
    }

    let customers = [];
    const stored = localStorage.getItem("customers");
    if (stored) {
      try {
        customers = JSON.parse(stored);
      } catch {
        customers = [];
      }
    }

    const duplicate = customers.find(c => c.code.toLowerCase() === code.toLowerCase());
    if (duplicate) {
      alert("Ø¦Û•Ù… Ú©Û†Ø¯ÛŒ Ú©Ú•ÛŒØ§Ø±Û• Ù¾ÛØ´ØªØ± Ø¨Û•Ú©Ø§Ø±Ø¯Û•Ù‡ÛÙ†Ø±Ø§ÛŒÛ•.");
      return;
    }

    const newCustomer = { code, name, mobile, balance, route, city, area, location };
    customers.push(newCustomer);
    localStorage.setItem("customers", JSON.stringify(customers));
    localStorage.setItem("lastCustomerAdded", Date.now().toString());

    alert("Ú©Ú•ÛŒØ§Ø± Ø¨Û• Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒ ØªÛ†Ù…Ø§Ø± Ú©Ø±Ø§!");

    // Ù¾Ø§Ú©Ú©Ø±Ø¯Ù† ÙÛ†Ø±Ù…
    document.getElementById("code").value = "";
    document.getElementById("name").value = "";
    document.getElementById("mobile").value = "";
    document.getElementById("balance").value = 0;
    document.getElementById("route").value = "";
    document.getElementById("city").innerHTML = '<option value="" selected disabled>Ø´Ø§Ø± Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>';
    document.getElementById("area").innerHTML = '<option value="" selected disabled>Ù†Ø§ÙˆÚ†Û• Ù‡Û•ÚµØ¨Ú˜ÛØ±Û•</option>';
    document.getElementById("location").value = "";
    document.getElementById("code").focus();
  }

  loadRouteData();
</script>

</body>
</html>
