function saveCustomer() {
  const code = document.getElementById("code").value.trim();
  const name = document.getElementById("name").value.trim();
  const mobile = document.getElementById("mobile").value.trim();
  const balance = parseFloat(document.getElementById("balance").value.trim() || "0");
  const route = document.getElementById("route").value;
  const city = document.getElementById("city").value;
  const area = document.getElementById("area").value;
  const location = document.getElementById("location").value.trim();

  if (!code || !name || !mobile) {
    alert("Please fill in all required fields (marked with *).");
    return;
  }

  const mobilePattern = /^[0-9+\-\s]{7,15}$/;
  if (!mobilePattern.test(mobile)) {
    alert("Please enter a valid mobile number.");
    return;
  }

  let customers = [];
  const stored = localStorage.getItem("customers");
  if (stored) {
    try {
      customers = JSON.parse(stored);
    } catch {
      customers = [];
    }
  }

  const duplicate = customers.find(c => c.code.toLowerCase() === code.toLowerCase());
  if (duplicate) {
    alert("This customer code is already used.");
    return;
  }

  const newCustomer = { code, name, mobile, balance, route, city, area, location };
  customers.push(newCustomer);
  localStorage.setItem("customers", JSON.stringify(customers));

  // فقط ناوەکەی نوێ لە localStorage نوسرێ
  localStorage.setItem("lastCustomerAdded", name); 

  alert("Customer saved successfully!");

  // فۆڕم پاکبکە بۆ ئامادەکردنی داتا نوێ
  document.getElementById("code").value = "";
  document.getElementById("name").value = "";
  document.getElementById("mobile").value = "";
  document.getElementById("balance").value = 0;
  document.getElementById("route").value = "";
  document.getElementById("city").value = "";
  document.getElementById("area").value = "";
  document.getElementById("location").value = "";
  document.getElementById("code").focus();
}
