<script>
  function logout() {
    window.location.href = './index.html';
  }

  function updatePartyCount() {
    const div = document.getElementById("party-count");
    if (!div) return;

    const stored = localStorage.getItem("customers");
    const customers = stored ? JSON.parse(stored) : [];
    div.textContent = customers.length.toLocaleString();
  }

  window.addEventListener("message", function(event) {
    if (event.data === "customer-added") {
      updatePartyCount();
    }
  });

  updatePartyCount();

  // Show today's date initially
  const today = new Date();
  const formattedDate = today.toLocaleDateString('en-GB');
  const dateEl = document.getElementById("dynamic-date");
  if (dateEl) {
    dateEl.textContent = `${formattedDate} - ${formattedDate}`;
  }

  function applyDateFilter() {
    const fromInput = document.getElementById("date-from");
    const toInput = document.getElementById("date-to");

    const fromDate = fromInput.value ? new Date(fromInput.value) : null;
    const toDate = toInput.value ? new Date(toInput.value) : null;

    if (fromDate && toDate && fromDate > toDate) {
      alert("Please make sure the 'From' date is earlier than or equal to the 'To' date.");
      return;
    }

    const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
    const fromStr = fromDate ? fromDate.toLocaleDateString('en-GB', options) : "From";
    const toStr = toDate ? toDate.toLocaleDateString('en-GB', options) : "To";
    if (document.getElementById("dynamic-date"))
      document.getElementById("dynamic-date").textContent = `${fromStr} - ${toStr}`;
  }

  // âœ… Update Receipts box with total amount and count
  function updateReceiptsSummary() {
    const allSales = JSON.parse(localStorage.getItem("allSales")) || [];
    const totalAmount = allSales.reduce((sum, sale) => sum + (sale.total || 0), 0);
    const totalReceipts = allSales.length;

    const amountEl = document.getElementById("receipts-amount");
    const unitsEl = document.getElementById("receipts-units");

    if (amountEl) amountEl.textContent = `IQD ${totalAmount.toLocaleString()}`;
    if (unitsEl) unitsEl.textContent = `${totalReceipts.toLocaleString()} Receipts`;
  }

  updateReceiptsSummary();
</script>
