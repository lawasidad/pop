<script>
  function logout() {
    window.location.href = './index.html';
  }

  function updatePartyCount() {
    const div = document.getElementById("party-count");
    if (!div) return;

    const stored = localStorage.getItem("customers");
    const customers = stored ? JSON.parse(stored) : [];
    div.textContent = customers.length.toLocaleString();
  }

  window.addEventListener("message", function(event) {
    if (event.data === "customer-added") {
      updatePartyCount();
    }
  });

  updatePartyCount();

  // Show today's date initially
  const today = new Date();
  const formattedDate = today.toLocaleDateString('en-GB'); // dd/mm/yyyy
  const dateEl = document.getElementById("dynamic-date");
  if (dateEl) {
    dateEl.textContent = `${formattedDate} - ${formattedDate}`;
  }

  // Date filter function
  function applyDateFilter() {
    const fromInput = document.getElementById("date-from");
    const toInput = document.getElementById("date-to");

    const fromDate = fromInput.value ? new Date(fromInput.value) : null;
    const toDate = toInput.value ? new Date(toInput.value) : null;

    if (fromDate && toDate && fromDate > toDate) {
      alert("Please make sure the 'From' date is earlier than or equal to the 'To' date.");
      return;
    }

    const dateEl = document.getElementById("dynamic-date");
    if (dateEl) {
      const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
      const fromStr = fromDate ? fromDate.toLocaleDateString('en-GB', options) : "From";
      const toStr = toDate ? toDate.toLocaleDateString('en-GB', options) : "To";
      dateEl.textContent = `${fromStr} - ${toStr}`;
    }

    // Add your data filtering logic here based on fromDate and toDate
  }

  // âœ… Update Receipts summary
  function updateReceiptsSummary() {
    const allSales = JSON.parse(localStorage.getItem("allSales")) || [];

    const totalAmount = allSales.reduce((sum, sale) => sum + (sale.total || 0), 0);
    const totalReceipts = allSales.length;

    const receiptsAmountEl = document.getElementById("receipts-amount");
    const receiptsUnitsEl = document.getElementById("receipts-units");

    if (receiptsAmountEl) {
      receiptsAmountEl.textContent = `IQD ${totalAmount.toLocaleString()}`;
    }

    if (receiptsUnitsEl) {
      receiptsUnitsEl.textContent = `${totalReceipts.toLocaleString()} Receipts`;
    }
  }

  updateReceiptsSummary();
</script>
