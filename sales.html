<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>وەسلەکان</title>
<style>
  body {
    font-family: Tahoma, sans-serif;
    background: #f9f9f9;
    padding: 20px;
  }
  .container {
    max-width: 900px;
    margin: auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.1);
    padding: 20px;
  }
  h2 {
    text-align: center;
    margin-bottom: 15px;
  }
  #totalSum {
    font-weight: bold;
    margin-bottom: 20px;
    color: #2a4bd7;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    direction: rtl;
    margin-bottom: 30px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
  }
  th {
    background: #e0e7ff;
  }
  .filter {
    margin-bottom: 20px;
    text-align: right;
  }
  label {
    margin-left: 10px;
  }
  input[type=date] {
    padding: 6px;
  }
  button {
    padding: 7px 14px;
    margin-left: 10px;
    background: #2563eb;
    border: none;
    color: white;
    cursor: pointer;
    border-radius: 4px;
  }
  button:hover {
    background: #1d4ed8;
  }
</style>
</head>
<body>
  <div class="container">
    <h2>کۆتایی هەموو وەسلەکان</h2>
    <div class="filter">
      <label for="startDate">لە بەرواری:</label>
      <input type="date" id="startDate" />
      <label for="endDate">تا بەرواری:</label>
      <input type="date" id="endDate" />
      <button onclick="applyFilter()">فلتەر بکە</button>
      <button onclick="clearFilter()">ڕەشەبکەرەوە</button>
    </div>
    <p id="totalSum">کۆی گشتی فرۆشتنەکان: 0 IQD</p>
    <div id="salesList"></div>
  </div>

<script>
  // وەرگرتنی داتاکانی فرۆشتن لە localStorage
  let allSales = JSON.parse(localStorage.getItem('allSales')) || [];

  // ئەم فەرمی داتاکان نیشاندەدات
  const salesList = document.getElementById('salesList');
  const totalSumEl = document.getElementById('totalSum');

  // فۆرماتکردنی بەروار و کات بە فۆرمات: 24/05/2025 13:05:12
  function formatDateTime(dateStr) {
    const d = new Date(dateStr);
    const day = String(d.getDate()).padStart(2, '0');
    const month = String(d.getMonth() +1).padStart(2, '0');
    const year = d.getFullYear();
    const hours = String(d.getHours()).padStart(2, '0');
    const minutes = String(d.getMinutes()).padStart(2, '0');
    const seconds = String(d.getSeconds()).padStart(2, '0');
    return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
  }

  // نیشاندانی هەموو وەسلەکان بەپێی داتاکان
  function renderSales(sales) {
    if (sales.length === 0) {
      salesList.innerHTML = '<p>هیچ وەسلەیەک بوونی نیە.</p>';
      totalSumEl.textContent = 'کۆی گشتی فرۆشتنەکان: 0 IQD';
      return;
    }

    let totalAll = 0;
    let html = '';
    sales.forEach((sale, idx) => {
      let saleTotal = 0;
      let itemsHtml = sale.items.map(item => {
        saleTotal += item.total;
        return `<tr>
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>${item.unitPrice.toLocaleString()} IQD</td>
          <td>${item.discount}%</td>
          <td>${item.total.toLocaleString()} IQD</td>
        </tr>`;
      }).join('');
      totalAll += saleTotal;

      html += `
      <h3>وەسلەی ${idx + 1} - کریار: ${sale.customer} - بەروار: ${formatDateTime(sale.timestamp)}</h3>
      <table>
        <thead>
          <tr>
            <th>ناوی بەرهەم</th>
            <th>ژمارە</th>
            <th>نرخی یەکە</th>
            <th>داشکاندن</th>
            <th>کۆی گشتی</th>
          </tr>
        </thead>
        <tbody>${itemsHtml}</tbody>
        <tfoot>
          <tr>
            <td colspan="4" style="text-align: center; font-weight: bold;">کۆی وەسلە</td>
            <td>${saleTotal.toLocaleString()} IQD</td>
          </tr>
        </tfoot>
      </table>`;
    });

    salesList.innerHTML = html;
    totalSumEl.textContent = `کۆی گشتی فرۆشتنەکان: ${totalAll.toLocaleString()} IQD`;
  }

  // داتای فلتەرکردن بەروار
  function applyFilter() {
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    let filtered = allSales;

    if(startDate) {
      const start = new Date(startDate);
      filtered = filtered.filter(sale => new Date(sale.timestamp) >= start);
    }
    if(endDate) {
      const end = new Date(endDate);
      // زیادکردنی کات بۆ بەکارهێنانی کۆتایی ڕۆژ
      end.setHours(23,59,59,999);
      filtered = filtered.filter(sale => new Date(sale.timestamp) <= end);
    }
    renderSales(filtered);
  }

  // ڕەشەبکردنی فلتەرەکان و نیشاندانی هەموو داتاکان
  function clearFilter() {
    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';
    renderSales(allSales);
  }

  // نیشاندانی هەموو وەسلەکان کاتێک بوە بەیانی پەڕەکە
  window.onload = () => {
    renderSales(allSales);
  }
</script>

</body>
</html>
