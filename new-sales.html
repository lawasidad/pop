<!DOCTYPE html>
<html>
<head>
  <title>New Sale</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { margin: 5px; padding: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #eee; }
  </style>
</head>
<body>
  <h2>Create New Sale</h2>
  
  <label>Customer Name:</label>
  <input type="text" id="customerInput"><br><br>

  <table id="productTable">
    <thead>
      <tr>
        <th>Product</th>
        <th>Unit Price</th>
        <th>Quantity</th>
        <th>Discount (%)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button id="submitBtn">Submit Sale</button>

  <script>
    const products = [
      { name: "Coca Cola", price: 1000 },
      { name: "Pepsi", price: 800 },
      { name: "Chips", price: 500 },
    ];

    const tbody = document.querySelector("#productTable tbody");

    products.forEach((product, index) => {
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${product.name}</td>
        <td>${product.price}</td>
        <td><input type="number" id="qty-${index}" min="0" value="0"></td>
        <td><input type="number" id="discount-${index}" min="0" max="100" value="0"></td>
      `;

      tbody.appendChild(row);
    });

    const submitBtn = document.getElementById("submitBtn");
    const customerInput = document.getElementById("customerInput");

    submitBtn.onclick = () => {
      const customer = customerInput.value.trim();
      if (!customer) {
        alert("Enter customer name");
        return;
      }

      const items = [];

      products.forEach((product, index) => {
        const qty = parseInt(document.getElementById(`qty-${index}`).value);
        const discount = parseFloat(document.getElementById(`discount-${index}`).value);
        if (qty > 0) {
          const total = qty * product.price * (1 - discount / 100);
          items.push({
            productName: product.name,
            quantity: qty,
            unitPrice: product.price,
            discountPercent: discount,
            total: Math.round(total),
          });
        }
      });

      if (items.length === 0) {
        alert("Select at least one product");
        return;
      }

      const grandTotal = items.reduce((sum, item) => sum + item.total, 0);

      localStorage.setItem("lastSale", JSON.stringify({
        customer,
        items,
        grandTotal
      }));

      alert("Sale saved! Go to sales.html to view.");
    };
  </script>
</body>
</html>
